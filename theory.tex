%!TEX root =  index.tex

\section{Theory}


In this section, we will develop the theoretical foundation for the tools to calculate the space of Fourier expansions of some precision of Hermitian modular forms $\FE(\HSpace{k}{\Gamma})$.

We know that there is a basis of Fourier expansions such that all Fourier coefficients are over $\Q$. % TODO: ref

We start with the space of all possible Fourier expansions, i.e. with the space $\mathcal{M}_0 := \Q^\mathcal{I}$ for some index set $\mathcal{I}$. The tools in this section are all some specific conditions which lead to some vectorspace $\tilde{\mathcal{M}} \subset \Q^\mathcal{I}$ which are always superspaces of $\FE_\mathcal{I}(\HSpace{k}{\Gamma}) \subset \Q^\mathcal{I}$. Thus, when intersecting such space, we iteratively get new subspaces
\[ \mathcal{M}_{i+1} := \mathcal{M}_i \cap \tilde{\mathcal{M}} . \]
%
With other methods, we know the dimension of $\FE(\HSpace{k}{\Gamma})$. Thus we can easily determine whether $\mathcal{M}_i = \FE_\mathcal{I}(\HSpace{k}{\Gamma})$, i.e. whether we are finished and can terminate the algorithm.

It is not proven that this series of spaces eventually gets to $\FE_\mathcal{I}(\HSpace{k}{\Gamma})$ but from other research, this seems likely.
% TODO: ref

\subsection{Restriction to Elliptic modular forms}
\label{ellipticReduction}
\label{ellipticRestriction}

We develop the first method to calculate a vectorspace $\tilde{\mathcal{M}} \subset \FE(\HSpace{n}{\Gamma})$. This methods works by restricting Hermitian modular forms to Elliptic modular forms. A similar method to restrict Siegel modular forms to Elliptic modular forms has been presented in \cite{PoorYuen07Comp}.
 
Methods to calculate the vectorspace of Elliptic modular forms are well known and thus we gain information by this restriction.

We start by describing the restriction.

\begin{lemma}[Restriction]
\label{lemma:ellipticRestriction}
Let $f \colon \HalfPlane_2 \rightarrow \C$ be a Hermitian modular form of weight $k$ with $\nu \equiv 1$. Let $S \in \PM_2(\curlO)$.
Then, $\tau \mapsto f(S \tau) \colon \HalfPlane_1 \subseteq \C \rightarrow \C$ is an Elliptic modular form of weight $2k$ to $\Gamma_0(l)$, where $l$ is the denominator of $S^{-1}$.  %for some matrix $S \in \M_2(\Z)$ with $\Gamma(S) \subseteq \SL_2(\Z)$.

We write
\[  f[S] \colon \HalfPlane_1 \rightarrow \C, \quad \tau \mapsto f(S \tau) . \]

\proof
Define $\Gamma^H := \Sp_2(\curlO)$ as the translation group for $f$.
%not needed?
%Then, we can verify that
%\[ M := \SimpleMatrix{1_2}{B}{}{1_2} \in \Gamma^H, \quad B \in \Her_2(\curlO) . \]
Let $\tau \in \HalfPlane_1$. With $S = [s,t,u] \in \PM_2(\C)$ we have
\begin{align*}
\Im(S\tau) \quad = \quad& \frac{1}{2i} \left( S \tau - \overline{S}^T \overline{\tau} \right) \\
= \quad & \frac{1}{2i} S (\tau - \overline{\tau}) \\
= \quad & \frac{1}{2i} S \cdot 2i \Im(\tau) \\
= \quad & S \Im(\tau) > 0 ,
\end{align*}
%TODO: \nu(M'), warum ist das immer 1?
thus $S \tau \in \HalfPlane_2$. Thus, $\tau \mapsto f(S \tau)$ is a function $\HalfPlane_1 \rightarrow \C$.

Let $l := \det(S)$. That is the denominator of $S^{-1}$. Let $\SmallMatrix{a}{b}{c}{d} \in \Gamma_0(l) \subseteq \SL_2(\Z)$. We have
\begin{align*}
& S \frac{a \tau + b}{c \tau + d} \\
=\quad & (a (S \tau) + bS) \cdot ((c S^{-1}) (S \tau) + d)^{-1} \\
=\quad & \SimpleMatrix{a 1_2}{b S}{c S^{-1}}{d 1_2} \cdot S \tau .
\end{align*}
Define
\[ M := \SimpleMatrix{a 1_2}{b S}{c S^{-1}}{d 1_2} \in \M_4(\C) . \]
With $l | c$, we also have $c S^{-1} = \frac{c}{l} [u, -t, s] \in \M_2(\curlO)$, thus we have $M \in \M_4(\curlO)$.
Recall that we have $S = \overline{S}^T$ and $ad  - bc = 1$. Verify that we have $M \in \Sp_2(\curlO) = \Gamma^H$:
\begin{align*}
&  \overline{M}^T J_2 M \\
=\quad & \overline{\SimpleMatrix{a 1_2}{b S}{c S^{-1}}{d 1_2}}^T J_2 \SimpleMatrix{a 1_2}{b S}{c S^{-1}}{d 1_2} \\
=\quad & \SimpleMatrix
{(-ac S^{-1} + ac \overline{S^{-1}}^T)}
{(-ad 1_2 + cb \overline{S^{-1}}^T S)}
{(-bc \overline{S}^T S^{-1} + ad 1_2)}
{(-bd \overline{S}^T + bd S)} \\
=\quad & J_2 .
\end{align*}

Thus, because $f$ is a Hermitian modular form, we have
\begin{align*}
& f[S] \left(\SmallMatrix{a}{b}{c}{d} \tau\right) \\
=\quad & f\left(S \frac{a \tau + b}{c \tau + d} \right) \\
=\quad & f\left( M \cdot S \tau \right) \\
=\quad & \nu(M) \cdot \det(c S^{-1} S \tau + d 1_2)^k \cdot f(S \tau) \\
=\quad & (c \tau + d)^{2k} \cdot f[S](\tau) .
\end{align*}
This is the same as
\[ (f[S]) |_{2k} \SmallMatrix{a}{b}{c}{d} = f[S] . \]
It follows that $f[S]$ is an Elliptic modular form of weight $2k$ to $\Gamma_0(l)$.
\endproof
\end{lemma}


\begin{remark}\label{remark-nu}
Let us analyze the case $\nu \not\equiv 1$. According to \cite{Dern01Herm}, only for $\Delta \equiv 0 \pmod{4}$, there is a single non-trivial Abel character $\nu$. This $\nu$ has the following properties (see \cite{Dern01Herm}):
\begin{align*}
\nu(J_2) & = 1 , \\
\nu(\Trans(H)) & = (-1)^{h_1 + h_4 + |h_2|^2}, & H = [h_1, h_2, h_4] \in \Her_2(\curlO) \\
\nu(\Rot(U)) & = (-1)^{|1+u_1+u_4|^2 |1+u_2+u_3|^2 + |u_1 u_4|^2} & U = \SmallMatrix{u_1}{u_2}{u_3}{u_4} \in \GL_2(\curlO)
\end{align*}
Consider the proof of the previous lemma. To calculate $\nu(M)$ with the given equations, we need to represent $M$ in the generating system $J_2$, $\Trans(H)$ and $\Rot(U)$.

We must consider two different cases. Recall that we have $\SmallMatrix{a}{b}{c}{d} \in \SL_2(\Z)$, i.e. $ad - bc = 1$, $S = [s,t,u] \in \PM_2(\curlO)$ and
\[ M = \SimpleMatrix{a 1_2}{b S}{c S^{-1}}{d 1_2} \in \Sp_2(\curlO) . \]

Case 1: $c=0$. Then we have $ad=1$. Define $T := \frac{b}{d} S$. Then we have
\begin{align*}
& \Trans\left(\frac{b}{d} S\right) \Rot\left(\frac{1}{d} 1_2\right) \\
=\quad &
\SimpleMatrix{1_2}{\frac{b}{d} S}{}{1_2}
\SimpleMatrix{\frac{1}{d} 1_2}{}{}{d 1_2} \\
=\quad &
\SimpleMatrix{\frac{1}{d}1_2}{b S}{}{d 1_2} \\
=\quad& M .
\end{align*}
And we have
\begin{align*}
\nu\left(\Trans\left(\frac{b}{d} S\right)\right) & = (-1)^{\frac{b}{d}s + \frac{b}{d}u + \left|\frac{b}{d} t \right|^2}, \\
\nu\left(\Rot\left(\frac{1}{d} 1_2\right)\right) & = (-1)^{\left|1 + \frac{2}{d}\right|^2 + \left|\frac{1}{d^2}\right|^2} = 1 .
\end{align*}

Case 2: $c\neq 0$. Then we have
\begin{align*}
& \Trans\left(\frac{a}{c}S\right) \Rot\left(-\frac{1}{c}S\right) (-J_2) \Trans\left(-\frac{d}{c}S\right)^{-1} \\
=\quad & \SimpleMatrix{1_2}{\frac{a}{c}S}{}{1_2}
\SimpleMatrix{-\frac{1}{c}\overline{S}^T}{}{}{-cS^{-1}}
(-J_2)
\SimpleMatrix{1_2}{-\frac{d}{c}S}{}{1_2}^{-1} \\
=\quad &
\SimpleMatrix{-\frac{1}{c}\overline{S}^T}{-a 1_2}{}{-cS^{-1}}
\SimpleMatrix{}{1_2}{-1_2}{}
\SimpleMatrix{1_2}{\frac{d}{c}S}{}{1_2} \\
=\quad &
\SimpleMatrix{-\frac{1}{c}\overline{S}^T}{a 1_2}{}{-cS^{-1}}
\SimpleMatrix{}{1_2}{-1_2}{-\frac{d}{c}S} \\
=\quad &
\SimpleMatrix{a 1_2}{-\frac{1}{c}\overline{S}^T + \frac{ad}{c}S}{cS^{-1}}{d 1_2} \\
=\quad &
M.
\end{align*}
And we have
\begin{align*}
\nu\left( \Trans\left(\frac{a}{c}S \right) \right) & = (-1)^{\frac{a}{c}s + \frac{a}{c}u + \left|\frac{a}{c} t \right|^2} , \\
\nu\left( \Rot\left(-\frac{1}{c}S \right) \right) & = (-1)^{\left|1-\frac{1}{c}s -\frac{1}{c}u\right|^2 \left|1 - \frac{2}{c}\Re(t) \right|^2 + \left| \frac{su}{c^2} \right|^2 } , \\
\nu\left( -J_2 \right) & = -1 , \\
\nu\left( \Trans\left(-\frac{d}{c}S \right) \right)^{-1} & = (-1)^{-\frac{d}{c}s - \frac{d}{c}u + \left|\frac{d}{c} t \right|^2} . \\
\end{align*}

As a conclusion for now, it looks complicated to restrict $\SmallMatrix{a}{b}{c}{d}$, i.e. the translation group $\Gamma^E$ for the Elliptic modular forms, to satisfy $\nu(M)=1$. For example, for the case $c=0$, one fulfilling condition would be $2 | b$.

To avoid such complications, we will use $\nu \equiv 1$ for the rest of our work.
\qed
\end{remark}

\

\begin{prelim}
We want to calculate a generating set for the Fourier expansions of Hermitian modular forms.

We define the index set
\[ \Lambda := \Set{0 \le \SimpleMatrix{a}{b}{\overline b}{c} \in \M_2(\curlO^\#)}{a,c \in \Z } \]
as the index for the Fourier coefficients of the Fourier expansions of our Hermitian modular forms.

For a holomorphic function $f \colon \HalfPlane_2 \rightarrow \C$, we write its Fourier expansion as
\[ f(Z) = \sum_{T \in \Lambda} a(T) \cdot e^{2 \pi i \cdot \tr(T Z)} \]
with its Fourier coefficients $a \colon \Lambda \rightarrow \Q$.

Note that some authors use $e^{\pi i}$ as the coefficient bases and define the index set $\Lambda$ in such a way that $\tr(TS) \in 2\Z$ for $T \in \Lambda$ and $S \in \Her_2(\curlO)$. In that case, $T$ is called "even" and one would only allow even matrices in $\Lambda$. We don't do that and we keep the factor $2$ in the coefficient base, i.e. we use $e^{2 \pi i}$.
\end{prelim}

\begin{remark}
\label{remark:restricted-by-S}
For any $S \in \PM_2(\curlO)$, for the restricted function $f[S] \colon \HalfPlane_1 \rightarrow \C$, this gives us
\[ f[S](\tau) = \sum_{T \in \Lambda} a(T) \cdot e^{2 \pi i \cdot \tr(T S \tau)}
= \sum_{T \in \Lambda} a(T) \cdot e^{2 \pi i \cdot \tr(T S) \tau} . \]
We use $a[S] \colon \N_0 \rightarrow \Q$ for the Fourier coefficients of $f[S]$, i.e. we have
\[ f[S](\tau) = \sum_{n \in \N_0} a[S](n) \cdot e^{2 \pi i n \tau} . \]
This gives us
\[ a[S] (n) = \sum_{T \in \Lambda, \tr(S T) = n} a(T) . \]
\endproof
\end{remark}

For the implementation of the algorithm, we need to define a finite precision of the index set of the Fourier coefficients of the Hermitian modular forms.
Fix $B := B_\F \in \N$ as a limit. Define the precision of the Fourier coefficient index
\[ \F := \F_B := \Set{\SimpleMatrix{a}{b}{\overline b}{c} \in \Lambda}{0 \le a , c < B_{\F}} \subseteq \Lambda . \]
% \Lambda sind die die Indizes der Fourier-Entwicklung einer Hermitischen Modulform.

The main algorithm is going to be described in \cref{main-algo}. It will start with the vectorspace of all possible Fourier expansions for the precision index set $\F$ and reduce that vectorspace.

\begin{lemma}
\label{lemma:fprecisionlimit}
Given a Hermitian modular form $f$ and its Fourier expansion coefficients $a \colon \F_B \rightarrow \Q$ of the precision index set $\F_B$ and a matrix $S = [s,t,u] \in \PM_2(\curlO)$, the precision of the Fourier expansion of the Elliptic modular form $f[S]$ is given by
\[ \FPrecisionLimit{S} = B \cdot (s + u - 2 \left| t \right|) , \]
i.e. we can calculate the Fourier expansion coefficients (as described in \cref{remark:restricted-by-S})
\[ a[S] \colon \Set{k \in N_0}{k < \FPrecisionLimit{S}} \rightarrow \Q . \]

\proof
For a given $S \in \mathcal{S}$ and limit $B \in \N$ which restricts $\F \subset \Lambda$, $\FPrecisionLimit{S} \in \N_0$ is the limit such that for any $T \in \Lambda - \F$, $\tr(S T) \ge \FPrecisionLimit{S}$. Thus, for calculating the Fourier coefficients $T \in \Lambda$ with $\tr(S T) \in \Set{0, \dots, \FPrecisionLimit{S} - 1}$, it is sufficient to enumerate the $T \in \F$.

Let $S = [s,t,u]$ and $T = [a,b,c]$. Recall that $S \in \PM_2(\curlO)$. Then we have
\[ \tr(S T) = as + \overline{t} b + t \overline{b} + cu = as + cu + 2 \Re(\overline{t} b) . \]
Because $T \ge 0$, we have $ac \ge \left| b \right|^2$ and thus
\[ \left| b \right| \le \sqrt{ac} \le \max(a,c). \]
Thus,
\[ 2 \Re(\overline{t} b) \ge -2 \left| t \right| \left| b \right| \ge -2 \left| t \right| \max(a,c). \]
We also have $as + cu \ge \max(a,c) (s + u)$. Assuming $T \in \Lambda - \F$, we have $\max(a,c) \ge B$. For such $T$, we get
\[ \tr(ST) \ge B \cdot (s + u - 2 \left| t \right|) . \]
Given $S > 0$, we have $su > \left| t \right|^2$. Then we have
\begin{align*}
& s + u - 2 \left| t \right| > 0 \\
\Leftrightarrow \quad & su + u^2 - 2 \left| t \right| u > 0 \\
\Leftrightarrow \quad & \left( \left|t\right|^2 + u^2 - 2 \left| t \right| u \right) + (su - \left|t \right|^2) > 0 \\
\Leftrightarrow \quad & \left(\left| t \right| - u \right)^2 + (su - \left| t \right|^2) > 0 .
\end{align*}
Thus, for $B > 0$, we have
\[ B \cdot (s + u - 2 \left| t \right|) > 0 . \]
All inequalities were sharp estimations\footnote{For example, let $S=[2,-1,1]$. Then you have $s+u-2 \left| t \right| = 1$. With $c=B$ and $a=b=1$, you hit the limit $\tr(S T) = 2 + B - 2 = B = \FPrecisionLimit{S}$. }, %
thus we get
\[ \FPrecisionLimit{S} = B \cdot (s + u - 2 \left| t \right|) . \qedhere \]
\endproof
\end{lemma}

\begin{remark}
\label{remark:algo-mainstep1}
Let $\mathcal{M}_i$ be a sub vector space of Hermitian modular form Fourier expansions $a \colon \F \rightarrow \Q$, i.e. $\mathcal{M}_i \subset \FE_\F(\HSpace{k}{\Gamma})$.
\Cref{remark:restricted-by-S} and \cref{lemma:fprecisionlimit} gives us the tools to reduce $\mathcal{M}_i$ to a sub vector space $\mathcal{M}_{i+1} \subset \mathcal{M}_i$. Note that we don't neccessarily have strict reductions. In many cases, $\mathcal{M}_{i+1} = \mathcal{M}_i$.

For a given $S \in \PM_2(\curlO)$, when calculating the restrictions $a \mapsto a[S]$ for all $a \in \mathcal{M}_i$, we must only get Fourier expansions of Elliptic modular forms.
In \cref{remark:how-to-calc-aS}, we will see how to calculate the restricted Elliptic modular form Fourier expansions $a[S]$.
%TODO: ref!
And we can independently calculate the space of Elliptic modular form Fourier expansions and thus calculate the new space.

Thus,
\[  \mathcal{M}_{i+1} := \Set{a \in \mathcal{M}_i}{a[S] \in \FE_{\F(S)}(\ESpace{k}{\Gamma_0(l_S)})} \cup \Set{a \in \mathcal{M}_i}{a[S] \equiv 0}. \]
\end{remark}

\begin{remark}
\label{remark:reducedCurlF}
\label{reducedCurlF}
In the algorithm, we want to work with Fourier expansions in $\Q^\F$. A canonical basis is the set $\F$. We analyze how practical this is in a Computer implementation.

With $[a,b,c] \in \F$, we have $0\le a,c<B$, thus there are only a finite number of possible $(a,c) \in \N_0^2$. Because $0 \le [a,b,c]$, we get $ac - \left| b \right|^2 \ge 0$ and thus $b$ is also always limited. Thus, $\F$ is finite but it might be huge for even small $B$.
For example\footnote{ This example was calculated with the code at \cite{Zeyer13Github}.},
\begin{align*}
& \text{for } D=-3, B=10,\quad \text{we have } \; \# \F = 21892. \\
& \text{for } D=-3, B=20,\quad \text{we have } \; \# \F = 413702.
\end{align*}
%
Because we want $a \in \Q^\F$ to be a Fourier expansions of Hermitian modular forms, we can assume that $a$ is invariant under $\GL_2(\curlO)$. This means that we have
\[ \det(U)^k a(T[U]) = a(T) \quad \forall\ U \in \GL_2(\curlO) , \]
where $k$ is the weight of the Hermitian modular forms.
This is the set $\invar{\Q^\F}{\GL_2(\curlO)}$, i.e. all the Fourier expansions which satisfy this invariation. In our algorithm, we can work with that set instead if we want to calculate Hermitian modular forms.

Let us develop a basis of $\invar{\Q^\F}{\GL_2(\curlO)}$: For $T_1, T_2 \in \F$, define the equivalence relation
\[ T_1 \sim_{\GL_2(\curlO)} T_2 \quad \Leftrightarrow \quad \exists\ U \in \GL_2(\curlO) \colon\ T_1[U] = T_2. \]
Thus, we can identify a basis of $\invar{\Q^\F}{\GL_2(\curlO)}$ by $\F / { \sim_{\GL_2(\curlO)} }$.
We use the same invariation notation as for $\Q^\F$ and write
\[ \invarF{\F}{\GL_2(\curlO)} := \F / { \sim_{\GL_2(\curlO)} } . \]
We identify the elements in $\invarF{\F}{\GL_2(\curlO)}$ by reduced matrices%
\footnote{
The matrices are reduced in some sense of Minkowski. Details can be seen in \cref{impl:reduceGL} and in the source code at \cite{Zeyer13Github}. There is an algorithm which, for a given matrix $T \in \F$, calculates a reduced matrix $\tilde{T}$ and a determinant character $det$ such that $\tilde{T}[U] = T$ for some $U \in \GL_2(\curlO)$ with $\det(U) = e^{2 \pi i \cdot det / {\#(\curlO^\times)}}$.
}
in $\F$. Then, we have $\invar{\F}{\GL_2(\curlO)} \subseteq \F$.

Restricting the elements in $\F$ by the $\GL_2(\curlO)$-invariation makes the set $\invar{\F}{\GL_2(\curlO)} \subseteq \F$ much smaller and better to handle in Computer calculations.
For example,
\begin{align*}
& \text{for } D=-3, B=10,\quad \text{we have } \; \# \left(\invarF{\F}{\GL_2(\curlO)}\right) = 420, \\
& \text{for } D=-3, B=20,\quad \text{we have } \; \# \left(\invarF{\F}{\GL_2(\curlO)}\right) = 4840.
\end{align*}
%
This makes the set $\invarF{\F}{\GL_2(\curlO)}$, to identify a basis of the finite dimension vector space $\invar{\Q^\F}{\GL_2(\curlO)}$, much more practical to be used in a Computer implementation.
\qed
\end{remark}

\begin{remark}
\label{remark:how-to-calc-aS}
From \cref{remark:restricted-by-S} and \cref{lemma:fprecisionlimit}, we have
\[ a[S] (i) = \sum_{T \in \F, \tr(S T) = i} a(T) \]
for $i \in \N_0, i < \F(S)$.

%Let $v = (v_1, \dots, v_n) \in \Q^n$ be a vector in the base of reduced indices of $\F$ as described in \cref{remark:reducedCurlF} with
Set $N := \# \left( \invarF{\F}{\GL_2(\curlO)} \right)$ and let
\[ \invarF{\F}{\GL_2(\curlO)} = \Set{T_1, \dots, T_N} \]
where $T_j$ are the reduced matrices in $\F$.

We have
\[ \det(U)^k a(T_j[U]) = a(T_j) \] % =v_i
for all $j \le N$, $U \in \GL_2(\curlO)$, where $k$ is the weight of the Hermitian modular form.
For any $T \in \F$, we can (see also \cref{remark:reducedCurlF} and \cref{impl:reduceGL}) uniquely find $j_T \le N$ and $U_T \in \GL_2(\curlO)$ such that
\[ T_{j_T}[U_T] = T. \]
Then we have
\[ a(T) = a(T_{j_T}[U]) = \det(U_T)^{-k} a(T_{j_T}) . \]
Thus,
\[ a[S] (i) =  \sum_{T \in \F, \tr(S T) = i} \det(U_T)^{-k} a(T_{j_T}) . \]
This gives us the formula to calculate the Fourier expansion $a[S] \colon \Set{i \in \N_0}{i < \FPrecisionLimit{S}} \rightarrow \Q$.

This is a linear map $\Q^{\invarF{\F}{\GL_2(\curlO)}} \rightarrow \Q^{\Set{i \in \N_0}{i < \FPrecisionLimit{S}}} \cong \Q^{\FPrecisionLimit{S}}$ and the matrix $M \in \M_{\FPrecisionLimit{S} \times N}(\Q)$ of this map is given by the formula above. When we identify
\begin{align*}
a = & \; (a(T_1), \dots, a(T_N)), \\
a[S] = & \; (a[S](0), \dots, a[S](\FPrecisionLimit{S} - 1)),
\end{align*}
then the $i$-th row and the $j$-th column is given by
\[ M_{i,j} =  \sum_{T \in \F, \tr(S T) = i, j_T = j} \det(U_T)^{-k} \]
and we have
\[ M \cdot a = a[S] . \]
The implementation of the calculation of $M$ and its details are described in \cref{impl:calcMatrix}.
\qed
\end{remark}


\subsection{Elliptic modular cusp forms}
\label{cuspInfo}

Restricting the space of Hermitian modular form Fourier expansion space via \cref{remark:algo-mainstep1} is probably not enough. % TODO: ref, why?

Another method is to use information from cusp forms. We can restrict them in a similar way as earlier and we get relations between the restrictions and the space of Elliptic modular cusp forms.

\begin{prelim}
\label{prelim:cuspInfo}
Let $\hat{c} \in \Q \cup \Set{\infty}$ be a representation of a cusp in $\Gamma_0(l)$. For our method, we are only interested in $\hat{c} \ne \infty$. We choose a matrix $M = M_{\hat{c}} = \SmallMatrix{a}{b}{c}{d} \in \SL_2(\Z)$ such that $M \infty = \hat{c}$. We show in \cref{lemma:cuspmatrixMc} how to do that. $M$ is also called a cusp matrix.

Let $f \colon \HalfPlane_2 \rightarrow \C$ be a Hermitian modular form and $S \in \PM_2(\curlO)$. Now we look at $f[S] |_{2k} M$. We have
\begin{align*}
& (f[S] |_{2k} M) (\tau) \\
=\quad & (c \tau + d)^{-2k} \cdot f[S](M \tau) \\
=\quad & \det(c 1_2 \tau + d 1_2)^{-k} \cdot f(S (M \tau)) \\
=\quad & \det(c 1_2 \tau + d 1_2)^{-k} \cdot f( (a S \tau + b S) ( c S^{-1} S \tau + d) ) \\
=\quad & \det(c 1_2 \tau + d 1_2)^{-k} \cdot f( \tilde{M} (S \tau) ) \\
=\quad & \det(c 1_2 \tau + d 1_2)^{-k} \cdot (f |_k \tilde{M}) (S \tau) \cdot \det(c 1_2 \tau + d 1_2)^{k} \\
=\quad & ( f |_k \tilde{M} ) (S \tau) \\
=\quad & ( f |_k \tilde{M} )[S] (\tau) ,
\end{align*}
where
\[ \tilde{M} = \SimpleMatrix{a1_2}{bS}{cS^{-1}}{d1_2} \in \Sp_2(\K) . \]
%
We can find
\[ \gamma \in \Sp_2(\curlO), \quad R = \SimpleMatrix{\tilde{S}}{\tilde{T}}{0_2}{\overline{\tilde{S}^{-1}}^T} \in \Sp_2(\K) \]
such that $\tilde{M} = \gamma R$. We describe the details in \cref{solveR}.
Then, we have
\begin{align*}
& (f[S] |_{2k} M) (\tau) \\
=\quad& ( f |_k \tilde{M} )[S] (\tau) \\
=\quad& ( f |_k \gamma |_k R  )[S] (\tau) \\
=\quad& (f |_k R) [S] (\tau) \\
=\quad& \det\left(\overline{\tilde{S}^{-1}}^T\right)^{-k} \cdot f(R  (S \tau)) \\
=\quad& \overline{\det(\tilde{S})}^k \cdot
f \left(\left(\tilde{S} \cdot S \tau + \tilde{T}\right) \cdot \left(\overline{\tilde{S}^{-1}}^T\right)^{-1}\right) \\
=\quad& \overline{\det(\tilde{S})}^k \cdot f\left( \tilde{S} S \overline{\tilde{S}}^T \tau + \tilde{T} \overline{\tilde{S}}^T \right) .
\end{align*}

Thus, a cusp $\hat{c}$ and $S \in \PM_2(\curlO)$ gives us a linear map $f \mapsto f[S] | M_{\hat{c}}$ which we can calculate as described. %TODO: more...
%And given Hermitian modular forms, we must only get Elliptic modular cusp forms.

Via other methods, we can more directly calculate the vectorspace of Elliptic modular cusp forms in $M_{\hat{c}}$.

By comparing this, we gain new information and we have another method to reduce $\mathcal{M}_i$.
\end{prelim}

\begin{lemma}
\label{lemma:cuspmatrixMc}
Let $\hat{c} \in \Q \cup \Set{\infty}$. Then there exists a matrix $M = \SmallMatrix{a}{b}{c}{d} \in \Sp_1(\Z)$ such that $\frac{a \infty + b}{c \infty + d} = M \infty = c$. 
\begin{proof}
Case 1: $\hat{c} = \infty$. Then we can choose $M = 1_2$.

Case 2: $\hat{c} = 0$. Then we can choose $M = J_2$.

Case 3: $\hat{c} \in \Q^\times$. Let $\hat{c} = \frac{a}{b}$ with $a \in \Z$, $c \in \N$ such that there is no common denominator of $a$ and $b$. Then we can select $b, d \in \Z$ such that $1 = a c - b d$. Then we have $M = \SmallMatrix{a}{b}{c}{d} \in \Sp_1(\Z)$ and $M \infty = \hat{c}$.
\end{proof}
\end{lemma}

\begin{lemma}[$solveR$]
\label{lemma:solveR}
\label{solveR}
\label{impl:solveR}
% 28.4.13 weiter Teil 2 R_i
% 27.4. ...?
% 30.4. \tilde{M} = \gamma R
Let
\[ \tilde{M} = \SimpleMatrix{a 1_2}{b S}{c S^{-1}}{d 1_2} \in \Sp_2(\curlO) , \]
where
\[ \SimpleMatrix{a}{b}{c}{d} \in \SL_2(\Z), \quad S \in \Her_2(\curlO) . \]
We can find
\[ \gamma \in \Sp_2(\curlO), \quad R = \SimpleMatrix{\tilde{S}}{\tilde{T}}{0_2}{\overline{\tilde{S}^{-1}}^T} \in \Sp_2(\K) \]
such that $\tilde{M} = \gamma R$.
\begin{proof}
It follows a lengthy constructive proof.

Consider the embedding of $M_1 = \SmallMatrix{a_1}{b_1}{c_1}{d_1}, M_2 = \SmallMatrix{a_2}{b_2}{c_2}{d_2} \in \Sp_1(\K)$
\[ M_1 \times M_2 := \begin{pmatrix}
a_1 & & b_1 & \\
& a_2 & & b_2 \\
c_1 & & d_1 & \\
& c_2 & & d_2
\end{pmatrix} \in \Sp_2(\K). \]
Write
\[ \tilde{M}_i = \begin{pmatrix}
a_{i,1} & a_{i,2} & b_{i,1} & b_{i,2} \\
a_{i,3} & a_{i,4} & b_{i,3} & b_{i,4} \\
c_{i,1} & c_{i,2} & d_{i,1} & d_{i,2} \\
c_{i,3} & c_{i,4} & d_{i,3} & d_{i,4}
\end{pmatrix} \]
for $\tilde{M}_i \in \Sp_2(\K)$.
We set
\[ \tilde{M}_1 := \tilde{M} \]
and
\[ \tilde{M}_{i+1} := \gamma_i \tilde{M_i} \]
for $\gamma_i \in \Sp_2(\curlO)$.
Note that we have
\begin{align*}
&a_{1,1} = a, \quad \quad a_{1,2} = 0,
&d_{1,1} = d, \quad \quad d_{1,2} = 0, \\
&a_{1,3} = 0, \quad \quad a_{1,4} = a,
&d_{1,3} = 0, \quad \quad d_{1,4} = d, \\
&\begin{pmatrix}
b_{1,1} & b_{1,2} \\
b_{1,3} & b_{1,4}
\end{pmatrix} = bS ,
& \begin{pmatrix}
c_{1,1} & c_{1,2} \\
c_{1,3} & c_{1,4}
\end{pmatrix} = cS^{-1} .
\end{align*}

1) We want to define $\gamma_1$ such that $c_{2,1} = c_{2,3} = 0$.
Set
\[ \gamma_1 := \begin{pmatrix}
a_{\gamma_1,1} & b_{\gamma_1,1} \\
c_{\gamma_1,1} & d_{\gamma_1,1}
\end{pmatrix} \times \begin{pmatrix}
a_{\gamma_1,4} & b_{\gamma_1,4} \\
c_{\gamma_1,4} & d_{\gamma_1,4}
\end{pmatrix} . \]
Given $0 = c_{2,3} = c_{\gamma_1,4} \cdot a_{1,3} + d_{\gamma_1,4} \cdot c_{1,3}$, where $a_{1,3} = 0$, we get $d_{\gamma_1,4} := 0$ and we can set $a_{\gamma_1,4} := 0$, $b_{\gamma_1,4} := 1$ and $c_{\gamma_1,4} := -1$ such that $\SmallMatrix{a_{\gamma_1,4}}{b_{\gamma_1,4}}{c_{\gamma_1,4}}{d_{\gamma_1,4}} \in \Sp_1(\curlO)$.

We want $0 = c_{2,1} = c_{\gamma_1,1} \cdot a_{1,1} + d_{\gamma_1,1} \cdot c_{1,1}$. In case we already have $c_{1,1} = 0$, we can select $\SmallMatrix{a_{\gamma_1,1}}{b_{\gamma_1,1}}{c_{\gamma_1,1}}{d_{\gamma_1,1}}  = 1_2 \in \Sp_1(\curlO)$. Otherwise: We have $c_{1,1} \in \K$ but there is a $l_1 \in \curlO$ such that $c_{1,1} \cdot l_1 \in \curlO$. Via \ifuncname{xgcd} (see \cref{xgcd}), we can find $d_1,a_{\gamma_1,1},b_{\gamma_1,1} \in \curlO$ such that $1 = a_{\gamma_1,1} \frac{a_{1,1} \cdot l_1}{d_1} + b_{\gamma_1,1} \frac{c_{1,1} \cdot l_1}{d_1}$ and $\frac{a_{1,1} \cdot l_1}{d_1},  \frac{c_{1,1} \cdot l_1}{d_1} \in \curlO$. Then set $c_{\gamma_1,1} := - \frac{c_{1,1} \cdot l_1}{d_1}$ and $d_{\gamma_1,1} := \frac{a_{1,1} \cdot l_1}{d_1}$. Then we have $\SmallMatrix{a_{\gamma_1,1}}{b_{\gamma_1,1}}{c_{\gamma_1,1}}{d_{\gamma_1,1}} \in \Sp_1(\curlO)$.

That way, we have defined $\gamma_1 \in \Sp_2(\curlO)$ and we have $c_{2,1} = c_{2,3} = 0$ in $\tilde{M}_2 = \gamma_1 \tilde{M}$.

2) In case we already have $c_{2,4} = 0$, we can skip this step with $\gamma_2 = 1_4$. Otherwise, we assume $c_{2,4} \ne 0$.

Consider
\[ \gamma_{2} = \SimpleMatrix{A_{\gamma_2}}{0_2}{0_2}{D_{\gamma_2}} \]
where $A_{\gamma_2} \in \Sp_1(\curlO)$ and $D_{\gamma_2} = \overline{A_{\gamma_2}^{-1}}^T \in \Sp_1(\curlO)$. Then we have $\gamma_2 \in \Sp_2(\curlO)$. Write $D_{\gamma_2} = \SmallMatrix{d_{\gamma_2,1}}{d_{\gamma_2,2}}{d_{\gamma_2,3}}{d_{\gamma_2,4}}$.

Then we have
\begin{align*}
\SimpleMatrix{c_{3,1}}{c_{3,2}}{c_{3,3}}{c_{3,4}} &= D_{\gamma_2} \SimpleMatrix{c_{2,1}}{c_{2,2}}{c_{2,3}}{c_{2,4}} \\
&= \SimpleMatrix{d_{\gamma_2,1}}{d_{\gamma_2,2}}{d_{\gamma_2,3}}{d_{\gamma_2,4}} \SimpleMatrix{0}{c_{2,2}}{0}{c_{2,4}} \\
&= \SimpleMatrix{0}{d_{\gamma_2,1} c_{2,2} + d_{\gamma_2,2} c_{2,4}}{0}{d_{\gamma_2,3} c_{2,2} + d_{\gamma_2,4} c_{2,4}} .
\end{align*}

We want $0 = c_{3,4} = d_{\gamma_2,3} \cdot c_{2,2} + d_{\gamma_2,4} \cdot c_{2,4}$. In case we already have $c_{2,2} = 0$, we can select $D_{\gamma_2} := J_1 \in \Sp_1(\curlO)$. Otherwise: Again, $c_{2,2}, c_{2,4} \in \K$ but we can select $l_2 \in \curlO$ such that $c_{2,2} \cdot l_2, c_{2,4} \cdot l_2 \in \curlO$. Again via \ifuncname{xgcd}, we can find $d_2,d_{\gamma_2,1},d_{\gamma_2,2} \in \curlO$ such that $1 = d_{\gamma_2,1} \frac{c_{2,2} \cdot l_2}{d_2} + d_{\gamma_2,2} \frac{c_{2,4} \cdot l_2}{d_2}$ and $\frac{c_{2,2} \cdot l_2}{d_2}, \frac{c_{2,4} \cdot l_2}{d_2} \in \curlO$. Set $d_{\gamma_2,3} := -\frac{c_{2,4}\cdot l_2}{d_2}$ and $d_{\gamma_2,4} := \frac{c_{2,2} \cdot l_2}{d_2}$. Then we have $D_{\gamma_2} \in \Sp_1(\curlO)$.

That way, we have defined $\gamma_2 \in \Sp_2(\curlO)$ and we have $c_{3,1} = c_{3,3} = c_{3,4} = 0$ in $\tilde{M}_3 = \gamma_2 \tilde{M}_2 = \gamma_2 \gamma_1 \tilde{M}$.

Note that we have $A_{\gamma_2} = \overline{D_{\gamma_2}^{-1}}^T = \SimpleMatrix{\overline{d_{\gamma_2,4}}}{-\overline{d_{\gamma_2,3}}}{-\overline{d_{\gamma_2,2}}}{\overline{d_{\gamma_2,1}}}$.

3) Now we
\[ \SimpleMatrix{a_{3,1}}{a_{3,2}}{a_{3,3}}{a_{3,4}} = A_{\gamma_2} \SimpleMatrix{a_{2,1}}{a_{2,2}}{a_{2,3}}{a_{2,4}} , \]
thus
\[ a_{3,1} = \overline{d_{\gamma_2,1}} \cdot a_{2,1} - \overline{d_{\gamma_2,3}} \cdot a_{2,3} . \]

We have $\tilde{M}_3 \in \Sp_2(\curlO)$, thus $\overline{\tilde{M}_3}^T \SmallMatrix{}{-1_2}{1_2}{} \tilde{M}_3 = \SmallMatrix{}{-1_2}{1_2}{}$. Thus
\[ \overline{\begin{pmatrix}
a_{3,1} & a_{3,3} & c_{3,1} & c_{3,3} \\
a_{3,2} & a_{3,4} & c_{3,2} & c_{3,4} \\
b_{3,1} & b_{3,3} & d_{3,1} & d_{3,3} \\
b_{3,2} & b_{3,4} & d_{3,2} & d_{3,4}
\end{pmatrix}} \cdot \begin{pmatrix}
-c_{3,1} & -c_{3,2} & -d_{3,1} & -d_{3,2} \\
-c_{3,3} & -c_{3,4} & -d_{3,3} & -d_{3,4} \\
a_{3,1} & a_{3,2} & b_{3,1} & b_{3,2} \\
a_{3,3} & a_{3,4} & b_{3,3} & b_{3,4}
\end{pmatrix} = \SimpleMatrix{}{-1_2}{1_2}{} .
 \]
It follows
\[
\begin{array}{cl}
& - \overline{a_{3,1}} \cdot c_{3,2} - \overline{a_{3,3}} \cdot c_{3,4} + \overline{c_{3,1}} \cdot a_{3,2} + \overline{c_{3,3}} \cdot a_{3,4} = 0 \\
\overset{c_{3,1}=c_{3,3}=c_{3,4}=0}{\Longrightarrow}\quad & \overline{a_{3,1}} \cdot c_{3,2} = 0 \\
\Longrightarrow \quad & a_{3,1} = 0 \quad \text{or} \quad c_{3,2} = 0 .
\end{array}
\]
Thus, either we are ready ($c_{3,2} = 0$) or we are not ($c_{3,2} \ne 0$) but then we have $a_{3,1} = 0$. We need that in the next step.

4) Assume that we have $c_{3,2} \ne 0$ and $a_{3,1} = 0$, otherwise skip this step with $\gamma_3 = 1_4$. Set
\[ \gamma_3 := \begin{pmatrix}
a_{\gamma_3,1} & b_{\gamma_3,1} \\
c_{\gamma_3,1} & d_{\gamma_3,1}
\end{pmatrix} \times \begin{pmatrix}
a_{\gamma_3,4} & b_{\gamma_3,4} \\
c_{\gamma_3,4} & d_{\gamma_3,4}
\end{pmatrix} . \]
With $\tilde{M}_4 = \gamma_3 \tilde{M}_3$, we have
\begin{align*}
c_{4,1} &= c_{\gamma_3,1} \cdot \underbrace{a_{3,1}}_{=0} + d_{\gamma_3,1} \cdot \underbrace{c_{3,1}}_{=0} , \\
c_{4,2} &= c_{\gamma_3,1} \cdot a_{3,2} + d_{\gamma_3,1} \cdot c_{3,2} , \\
c_{4,3} &= c_{\gamma_3,4} \cdot a_{3,2} + d_{\gamma_3,4} \cdot \underbrace{c_{3,2}}_{=0} , \\
c_{4,4} &= c_{\gamma_3,4} \cdot a_{3,4} + d_{\gamma_3,4} \cdot \underbrace{c_{3,4}}_{=0} .
\end{align*}
Set $c_{\gamma_3,4} := b_{\gamma_3,4} := 0$ and $a_{\gamma_3,4} := d_{\gamma_3,4} := 1$. Thus $\SmallMatrix{a_{\gamma_3,4}}{b_{\gamma_3,4}}{c_{\gamma_3,4}}{d_{\gamma_3,4}} = 1_2 \in \Sp_1(\curlO)$. Then we have $c_{4,3} = 0$ and $c_{4,4} = 0$.

Let $l_3 \in \curlO$ such that $a_{3,2} \cdot l_3, c_{3,2} \cdot l_3 \in \curlO$. Via \ifuncname{xgcd}, we can find $d_3,a_{\gamma_3,1},b_{\gamma_3,1} \in \curlO$ such that $1 = a_{\gamma_3,1} \frac{a_{3,2} \cdot l_3}{d_3} + b_{\gamma_3,1} \frac{c_{3,2} \cdot l_3}{d_3}$ and $\frac{a_{3,2} \cdot l_3}{d_3}, \frac{c_{3,2} \cdot l_3}{d_3} \in \curlO$. Set $c_{\gamma_3,1} := -\frac{c_{3,2} \cdot l_3}{d_3}$ and $d_{\gamma_3,1} := \frac{a_{3,2} \cdot l_3}{d_3}$. Then we have $\SmallMatrix{a_{\gamma_3,1}}{b_{\gamma_3,1}}{c_{\gamma_3,1}}{d_{\gamma_3,1}} \in \Sp_1(\curlO)$. And we have $c_{4,2} = 0$.

That way, we have defined $\gamma_3 \in \Sp_2(\curlO)$ and we have $c_{4,1} = c_{4,2} = c_{4,3} = c_{4,4} = 0$ in $\tilde{M}_4 = \gamma_3 \tilde{M}_3 = \gamma_3 \gamma_2 \gamma_1 \tilde{M}$.

5) We are ready. Now, set
\[ R := \tilde{M}_4 = \gamma_3 \gamma_2 \gamma_1 \tilde{M} \in \Sp_2(\K) \]
and
\[ \gamma :=  \gamma_1^{-1} \gamma_2^{-1} \gamma_3^{-1} \in \Sp_2(\curlO) \]
such that
\[ \gamma R = \tilde{M} . \]
Write
\[ R = \SimpleMatrix{\tilde{S}}{\tilde{T}}{0_2}{\tilde{U}} . \]
We have $R \in \Sp_2(\K)$, thus $J_2[R] = J_2$, i.e.
\begin{align*}
&\SimpleMatrix{\overline{\tilde{S}}^T}{}{\overline{\tilde{T}}^T}{\overline{\tilde{U}}^T}
\SimpleMatrix{}{-1_2}{1_2}{}
\SimpleMatrix{\tilde{S}}{\tilde{T}}{}{\tilde{U}} \\
=\quad & \SimpleMatrix{\overline{\tilde{S}}^T}{}{\overline{\tilde{T}}^T}{\overline{\tilde{U}}^T}
\SimpleMatrix{}{-\tilde{U}}{\tilde{S}}{\tilde{T}} \\
=\quad & \SimpleMatrix{0_2}{-\overline{\tilde{S}}^T \tilde{U}}{\overline{\tilde{U}}^T \tilde{S}}{%
-\overline{\tilde{T}}^T \tilde{U} + \overline{\tilde{U}}^T \tilde{T} } \\
=\quad & \SimpleMatrix{}{-1_2}{1_2}{}
\end{align*}
Thus, we have $\tilde{U} = \overline{\tilde{S}^{-1}}^T$.
\end{proof}
\end{lemma}
Note that this proof gives explicit formulas to calculate $\gamma$ and $R$. This has been implemented in \ifilename{helpers.py} as \ifuncname{solveR}. A list of test cases have also been generated in the function \ifuncname{test_solveR} in \ifilename{tests.py} which also indirectly test the \ifuncname{xgcd} and \ifuncname{divmod} implementation (described in \cref{xgcd}).

\begin{remark}
\label{remark:algo-mainstep2}
We want to develop the formulas to use the new information about the cusp expansion relations as described in \cref{prelim:cuspInfo}. This is very similar as the idea in \cref{remark:algo-mainstep1}, such that we can develop similar formulas as in \cref{remark:how-to-calc-aS}.

Recall that we have
\[ (f[S] |_{2k} M) (\tau) = \overline{\det(\tilde{S})}^k \cdot f\left( \tilde{S} S \overline{\tilde{S}}^T \tau + \tilde{T} \overline{\tilde{S}}^T \right) \]
for $\tilde{S}, \tilde{T} \in \Sp_1(\K)$ as described in \cref{prelim:cuspInfo} (via \ifuncname{solveR} from $M$ and $S$).

Then, for the Fourier expansion, we have
\begin{align*}
(f[S] |_{2k} M) (\tau)
&= \overline{\det(\tilde{S})}^k \cdot \sum_{T \in \Lambda} a(T) \cdot e^{2 \pi i \tr\left(T \tilde{S} S \overline{\tilde{S}}^T \tau + T \tilde{T} \overline{\tilde{S}}^T\right)} \\
&= \overline{\det(\tilde{S})}^k \cdot \sum_{T \in \Lambda} a(T) \cdot e^{2 \pi i \tr\left(T \tilde{S} S \overline{\tilde{S}}^T\right) \tau} \cdot e^{2 \pi i \tr\left(T \tilde{T} \overline{\tilde{S}}^T\right)} \\
&= \sum_{p \in \frac{1}{l} \N_0} (a[S]|_{2k} M) (p) \cdot e^{2 \pi i p \tau} ,
\end{align*}
\end{remark}
where $l \in \N$ such that $\tr\left(T \tilde{S} S \overline{\tilde{S}}^T\right) \cdot l \in \N_0$ for all $T \in \Lambda$ and
\[ (a[S]|_{2k} M) (p) = \overline{\det(\tilde{S})}^k \cdot \sum_{\begin{subarray}{c}
T \in \Lambda,\\
\tr\left(T \tilde{S} S \overline{\tilde{S}}^T\right) = p
\end{subarray}} a(T) \cdot e^{2 \pi i \tr\left(T \tilde{T} \overline{\tilde{S}}^T\right)} \]
for all $p \in \frac{1}{l} \N_0$.


\subsection{Algorithm}

Now we formulate the main algorithm based on the work previously developed in this chapter.

\begin{algo}
\label{main-algo}
We have the Hermitian modular form degree $n = 2$ fixed, as well as some $\Delta$ (for now, $\Delta \in \Set{3,4,8}$). Then we select some form weight $k \in \Z$ ($k \in \Set{1,\dots,20}$ or so), let $\curlO \subseteq \Q(\sqrt{-\Delta})$ be the maximal order (see \cref{maxorder}) and let $\Gamma = \Sp_2(\curlO)$. We use $\nu \colon \Gamma \rightarrow \C^\times$, $\nu \equiv 1$ as the Abel character (see \cref{remark-nu}).

\begin{enumerate}
%or: http://www.latex-community.org/forum/viewtopic.php?f=4&t=2209
%\renewcommand{\theenumi}{Step \arabic{enumi}}
\item
Start with $\mathcal{M}_1 := \Q^{\invarF{\F}{\GL_2(\curlO)}}$ and $i=1$.

\item\label{NextSStep} Enumerate matrices $S \in \PM_2(\curlO)$ and for each matrix perform the following steps.

%Select a set of matrices $\mathcal{S} \subseteq \M_2^T(\Z)$ with $0 < S \in \mathcal{S}$.
%Make $\mathcal{S}$ big enough.
%Now, for some $S \in \mathcal{S}$:

\item
In \cref{remark:algo-mainstep1} and more detailed in \cref{calcMatrix} about the restriction ($f \mapsto f[S]$), we get a superspace $\mathcal{M}^H_S \subset \Q^{\invarF{\F}{\GL_2(\curlO)}}$ of $\FE(\HSpace{k}{\Gamma})$.

\item
From \cref{remark:algo-mainstep2} and the cusp expansion information, we get a superspace $\mathcal{C}^H_S \subset \Q^{\invarF{\F}{\GL_2(\curlO)}}$ of $\FE(\HSpace{k}{\Gamma})$.

\item
Now set
\[ \mathcal{M}_{i+1} := \mathcal{M}_i \cap \mathcal{M}^H_S \cap \mathcal{C}^H_S . \]
%
%We set
%\[ \mathcal{M}_{k,\mathcal{S},\F}^H := \Set{ (a [S])_{S\in\mathcal{S}} }{\text{$a \in \Q^\F$ is $\GL_2(\curlO)$ invariant}} \subseteq \bigoplus_{S\in\mathcal{S}} \Q^{\FPrecisionLimit{S}} . \]
%The elements $a \in \Q^\F$ are Fourier expansions of Elliptic modular forms ($\HalfPlane_1 \rightarrow \C$) and $a(T) \in \Q$ for $T \in \F \subseteq \M_2(\curlO^\#)$ are the Fourier coefficients.
%
%We identify
% Das ist der Bildbereich der Abbildung.
%\[ \bigoplus_{S\in\mathcal{S}} \Q^{\FPrecisionLimit{S}} = \Q^N, \ \ N = \sum_{S\in\mathcal{S}} \FPrecisionLimit{S} . \]
%
%See \cref{lemma:fprecisionlimit}.
%
%We want to calculate the matrix of the linear function \[
%\invar{\Q^\F}{\GL_2(\curlO)} \rightarrow \bigoplus_{S\in\mathcal{S}} \Q^{\FPrecisionLimit{S}}, \ \ 
%a \mapsto (a[S])_{S\in\mathcal{S}} .
%\]
%The base of the destination room is canonical. The dimension is $N$.
%The base of the source room can be identified by $\invar{\F}{\GL_2(\curlO)}$.
%
%And we set
%\[ \mathcal{M}_{k, \mathcal{S},\F} := \bigoplus_{S\in\mathcal{S}} \FE_{\F(S)}(\ESpace{k}{\Gamma_0(l_S)}) \]
%where $\ESpace{k}{\Gamma_0(l_S)}$ is the vectorspace of Elliptic modular forms over $\Gamma_0(l_S)$. % Köcher-Krieg II.3

\item
If
\[ \dim \mathcal{M}_i = \dim \HSpace{k}{\Gamma} , \]
then we are ready and we have
\[ \mathcal{M}_i = \FE_\F(\HSpace{k}{\Gamma}) . \]

If not, increase $i$, return to step \ref{NextSStep} and select the next $S \in \PM_2(\curlO)$.
\end{enumerate}
\end{algo}

%Matrix-repr of f \in (\Q^{\CurlfF[G]})^G_Chi \mapsto (\sum_{tr(ST)=n} a(T))_{n,S}
%( )^{G, chi} meine ich die Menge der Elemente von Q^\cF[G], die a(T[g]) = chi(g) a(T) erfüllen
% Eine Basis davon kannst du dir mittels der Reduktionen von T überlegen
